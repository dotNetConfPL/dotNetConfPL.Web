@model dotNetConfPL.Web.Model.Stream

@{
    ViewBag.Title = "dotnetconf.pl";
}

<script src="~/lib/jquery/jquery.min.js"></script>
<script src="~/lib/signalr/jquery.signalR.min.js"></script>
<script src="/signalr/hubs"></script>

@{
    var url = @Model.Url;
}

<div id="inject-place">
    <label id="stream-title">Tu bedzie tytul streama</label>
    <iframe width="420" height="315" src="@url" frameborder="0" allowfullscreen></iframe>
</div>

<div>
    <p class="last-chance-text">
        Stream odświeża się automatycznie, w razie awarii
        <a style="font-size:12px;" id="ForceRefresh" href="@Url.Action("Stream")">Odświeżenie ostatniej szansy :)</a>
    </p>
</div>

<div class="success">
    <div class="container text-center">
        <div class="row" style="margin-top: 100px">
            <div class="col-md-6 col-md-offset-3">
                <h1>Live Stream</h1>
                <hr/>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        var injectHub = $.hubConnection.injectHub;
        injectHub.client.updateClient = function(stream, streaimInfo) {
            $('#inject-place iframe').attr('src', stream);
            $('#stream-title').html(streaimInfo);
        };

        $.connection.hub.start().done(function () {
            $('#btn-set-stream').click(function () {
                injectHub.server.updateStream($('#new-stream').val(), $('#password').val(), $('#selected-stream').val());
                $.post("@Url.Action("UpdateStream")", { newStream: $('#new-stream').val(), password: $('#password').val(), streamType: $('#selected-stream').val() });
            });
        });

        $.connection.hub.disconnected(function () {
            setTimeout(function () {
                $.connection.hub.start();
            }, 10000);
        });
    });
</script>