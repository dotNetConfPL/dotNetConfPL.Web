@model dotnetconfpl.Controllers.StreamModel

@{
    ViewBag.Title = "dotnetconf.pl";
}

<script src="/Scripts/jquery.signalR-1.1.3.min.js"></script>
<script src="/signalr/hubs"></script>

@{
    var url = @Model.CurrentStream;
}

<div id="inject-place">
   <iframe width="420" height="315" src="@url" frameborder="0" allowfullscreen></iframe> 
</div>

@if (Model.IsAdmin)
{
    <input id="new-stream" />
    <input id="password" />
    <button id="btn-set-stream">Set Stream</button>
}

<script type="text/javascript">
    $(function () {
        var injectHub = $.connection.injectHub;
        injectHub.client.updateClient = function(stream) {
            $('#inject-place iframe').attr('src', stream);
        };
        
        $.connection.hub.start().done(function () {
            $('#btn-set-stream').click(function () {
                injectHub.server.updateStream($('#new-stream').val(), $('#password').val());
                $.post("@Url.Action("UpdateStream")", { newStream: $('#new-stream').val(), password: $('#password').val() });
            });
        });
    });
</script>